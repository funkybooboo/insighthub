openapi: 3.1.0
info:
  title: InsightHub RAG API
  version: 0.1.0
servers:
  - url: http://localhost:5000
    description: Local dev server
tags:
  - name: Health
    description: Health check & metrics
  - name: Authentication
    description: User authentication
  - name: Workspaces
    description: Workspace management
  - name: Documents
    description: Workspace documents
  - name: Chat
    description: Chat interactions
  - name: Rag
    description: Rag configuration & Wikipedia fetch
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        email:
          type: string
        full_name:
          type: string
          nullable: true
        created_at:
          type: string
        theme_preference:
          type: string
    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
        user:
          $ref: '#/components/schemas/User'
    Document:
      type: object
      properties:
        id:
          type: integer
        workspace_id:
          type: integer
        filename:
          type: string
        file_size:
          type: integer
        mime_type:
          type: string
        created_at:
          type: string
    HealthStatus:
      type: object
      properties:
        status:
          type: string
paths:
  /heartbeat:
    get:
      tags:
        - Health
      summary: Simple heartbeat check
      responses:
        '200':
          description: alive
  /health:
    get:
      tags:
        - Health
      summary: Health check
      responses:
        '200':
          description: healthy
  /metrics:
    get:
      tags:
        - Health
      summary: Application metrics
      responses:
        '200':
          description: metrics
          content:
            application/json:
              schema:
                type: object
  /api/auth/signup:
    post:
      tags:
        - Authentication
      summary: Sign up
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, password]
              properties:
                username:
                  type: string
                email:
                  type: string
                password:
                  type: string
                full_name:
                  type: string
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/auth/me:
    get:
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /api/auth/logout:
    post:
      tags:
        - Authentication
      responses:
        '200':
          description: ok
  /api/auth/default-rag-config:
    get:
      tags:
        - Rag
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ok
    put:
      tags:
        - Rag
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ok
  /api/workspaces:
    get:
      tags:
        - Workspaces
      responses:
        '200':
          description: ok
    post:
      tags:
        - Workspaces
      responses:
        '201':
          description: created
  /api/workspaces/{workspace_id}:
    get:
      tags:
        - Workspaces
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
    patch:
      tags:
        - Workspaces
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
    delete:
      tags:
        - Workspaces
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
  /api/workspaces/{workspace_id}/rag-config:
    get:
      tags:
        - Rag
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
    post:
      tags:
        - Rag
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
    patch:
      tags:
        - Rag
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
  /api/workspaces/{workspace_id}/stats:
    get:
      tags:
        - Workspaces
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
  /api/workspaces/{workspace_id}/documents/upload:
    post:
      tags:
        - Documents
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  document:
                    $ref: '#/components/schemas/Document'
        '400':
          description: invalid
  /api/workspaces/{workspace_id}/documents:
    get:
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  documents:
                    type: array
                    items:
                      $ref: '#/components/schemas/Document'
                  count:
                    type: integer
  /api/workspaces/{workspace_id}/documents/{doc_id}:
    delete:
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
        - name: doc_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
  /api/chat:
    post:
      tags:
        - Chat
      responses:
        '200':
          description: ok
  /api/sessions:
    get:
      tags:
        - Chat
      responses:
        '200':
          description: ok
  /api/sessions/{session_id}/messages:
    get:
      tags:
        - Chat
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
  /api/workspaces/{workspace_id}/rag/wikipedia:
    post:
      tags:
        - Rag
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
      responses:
        '200':
          description: ok

version: '3'

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list
    silent: true

  up:
    desc: Start all services
    cmds:
      - task down
      - docker compose up -d

  down:
    desc: Stop all services, including dev and prod profiles
    cmds:
      # Stop and remove containers for ALL profiles
      - docker compose --profile dev down --remove-orphans
      - docker compose --profile prod down --remove-orphans
      - docker compose down --remove-orphans
      - docker network prune -f

  dev:
    desc: Start development environment
    cmds:
      - task down
      - docker compose --profile dev up --build -d

  prod:
    desc: Start production environment
    cmds:
      - task down
      - docker compose --profile prod up --build -d

  logs:
    desc: Show service logs
    cmds:
      - docker compose logs -f

  ps:
    desc: Show service status
    cmds:
      - docker compose ps

  clean:
    desc: Remove containers and volumes (all profiles)
    cmds:
      - docker compose --profile dev down -v --remove-orphans
      - docker compose --profile prod down -v --remove-orphans
      - docker compose down -v --remove-orphans
